{% extends "base.html" %}

{% block title %}Send Message{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header bg-primary text-white text-center">
                    <h3 class="mb-0">
                        <i class="fas fa-paper-plane"></i> Send Message
                    </h3>
                </div>
                <div class="card-body p-4">
                    <div class="text-center mb-4">
                        <i class="fas fa-envelope text-primary" style="font-size: 3rem;"></i>
                        <p class="text-muted mt-3">
                            Fill out the form below to send your message. Both messages will be combined and sent to the admin.
                        </p>
                    </div>
                    
                    <form method="POST" id="messageForm">
                        <div class="mb-4">
                            <label for="message1" class="form-label fw-bold">
                                <i class="fas fa-comment text-primary"></i> Message 1
                            </label>
                            <textarea class="form-control" 
                                      id="message1" 
                                      name="message1" 
                                      rows="4" 
                                      placeholder="Enter your first message here..."
                                      maxlength="1000"></textarea>
                            <div class="form-text">
                                <span id="charCount1">0</span>/1000 characters
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="message2" class="form-label fw-bold">
                                <i class="fas fa-comment text-success"></i> Message 2 (Optional)
                            </label>
                            <textarea class="form-control" 
                                      id="message2" 
                                      name="message2" 
                                      rows="4" 
                                      placeholder="Enter your second message here..."
                                      maxlength="1000"></textarea>
                            <div class="form-text">
                                <span id="charCount2">0</span>/1000 characters
                            </div>
                        </div>
                        
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Note:</strong> At least one message is required. You can fill out just one or both message fields.
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="sendBtn">
                                <i class="fas fa-paper-plane"></i> Send Messages
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Message Preview -->
            <div class="card mt-4">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-eye"></i> Message Preview
                    </h6>
                </div>
                <div class="card-body">
                    <div class="bg-light p-3 rounded">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary">Message 1:</h6>
                                <p id="preview1" class="text-muted">No message entered</p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-success">Message 2:</h6>
                                <p id="preview2" class="text-muted">No message entered</p>
                            </div>
                        </div>
                        <hr>
                        <h6>Telegram Message Format:</h6>
                        <div id="telegramPreview" class="bg-white p-3 rounded border">
                            üì® <strong>New Message Received</strong><br><br>
                            üî∏ <strong>Message 1:</strong> <span id="telegram1">No message</span><br><br>
                            üîπ <strong>Message 2:</strong> <span id="telegram2">No message</span><br><br>
                            ‚è∞ <strong>Sent at:</strong> <span id="timestamp">Current time</span><br>
                            ü§ñ <strong>Bot:</strong> Generated via link
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Security Notice -->
            <div class="card mt-4">
                <div class="card-header bg-warning">
                    <h6 class="mb-0">
                        <i class="fas fa-shield-alt"></i> Security & Privacy
                    </h6>
                </div>
                <div class="card-body">
                    <ul class="mb-0">
                        <li>This link is one-time use only</li>
                        <li>Messages are sent securely via Telegram</li>
                        <li>No data is stored on this server after sending</li>
                        <li>Link expires after sending or in 24 hours</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Character counting and live preview
function updateCharacterCount() {
    const message1 = document.getElementById('message1').value;
    const message2 = document.getElementById('message2').value;
    
    // Update character counts
    document.getElementById('charCount1').textContent = message1.length;
    document.getElementById('charCount2').textContent = message2.length;
    
    // Update preview
    document.getElementById('preview1').textContent = message1 || 'No message entered';
    document.getElementById('preview2').textContent = message2 || 'No message entered';
    document.getElementById('telegram1').textContent = message1 || 'No message';
    document.getElementById('telegram2').textContent = message2 || 'No message';
    document.getElementById('timestamp').textContent = new Date().toLocaleString();
}

// Add event listeners
document.getElementById('message1').addEventListener('input', updateCharacterCount);
document.getElementById('message2').addEventListener('input', updateCharacterCount);

// Form submission
document.getElementById('messageForm').addEventListener('submit', function(e) {
    const message1 = document.getElementById('message1').value.trim();
    const message2 = document.getElementById('message2').value.trim();
    
    if (!message1 && !message2) {
        e.preventDefault();
        alert('Please enter at least one message before submitting.');
        return;
    }
    
    // Show loading state
    const sendBtn = document.getElementById('sendBtn');
    sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending Messages...';
    sendBtn.disabled = true;
});

// Initialize preview
updateCharacterCount();

// Auto-resize textareas
function autoResize(textarea) {
    textarea.style.height = 'auto';
    textarea.style.height = textarea.scrollHeight + 'px';
}

document.getElementById('message1').addEventListener('input', function() {
    autoResize(this);
    updateCharacterCount();
});

document.getElementById('message2').addEventListener('input', function() {
    autoResize(this);
    updateCharacterCount();
});
</script>
{% endblock %}